---
import { GetStaticPathsResult } from "astro"
import redirects from "../features/redirects/redirects.json"

export async function getStaticPaths(): Promise<GetStaticPathsResult> {
  const sanitizeSource = (source: string) => {
    let newSource = source
    if (newSource[newSource.length - 1] === "/") {
      newSource = newSource.slice(0, newSource.length - 1)
    }
    return newSource[0] === "/" ? newSource.slice(1, newSource.length) : newSource
  }
  return redirects.redirects.map((entry) => {
    return {
      params: { redirect: sanitizeSource(entry.source) },
      props: {
        to:
          entry.destination.charAt(0) === "/" || entry.destination.includes("https://")
            ? entry.destination
            : "/" + entry.destination,
      },
    }
  })
}

const { to } = Astro.props
---

<meta http-equiv="refresh" content={`0; url=${to}`} />
