---
section: automation
date: Last Modified
title: "Automate Contract Balance Top-up"
isMdx: true
whatsnext: { "FAQs": "/chainlink-automation/faqs/" }
---

import { Aside, CodeSample } from "@components"

Some smart contract applications require you to maintain a certain Ethereum balance to ensure optimal operation. You can automate this using Chainlink Automation. Use these smart contracts to monitor and top-up balances on your smart contracts.

View the [EthBalanceMonitor.sol contract](https://github.com/smartcontractkit/documentation/blob/main/public/samples/Automation/tutorials/EthBalanceMonitor.sol) on GitHub.

<Aside type="caution" title="Disclaimer">
  This tutorial represents an example of using a Chainlink product or service and is provided to help you understand how
  to interact with Chainlink's systems and services so that you can integrate them into your own. This template is
  provided "AS IS" and "AS AVAILABLE" without warranties of any kind, has not been audited, and may be missing key
  checks or error handling to make the usage of the product more clear. Do not use the code in this example in a
  production environment without completing your own audits and application of best practices. Neither Chainlink Labs,
  the Chainlink Foundation, nor Chainlink node operators are responsible for unintended outputs that are generated due
  to errors in code.
</Aside>

Alternatively follow the detailed native (ETH) Gas Balance Monitor guide below.

## Objective

This Automation contract monitors and funds Ethereum addresses that developers might need to top up frequently based on a configurable threshold. You will deploy this example monitor contract and use the [automation.chain.link](https://automation.chain.link/) interface to register an upkeep and run the contract. To learn the basics about Chainlink Automation, read the [Chainlink Automation Introduction](/chainlink-automation/introduction).

For this example, use the Polygon Mumbai testnet to simplify access to testnet funds. Later, you can use another EVM-compatible network of your choice.

## Before you begin

Before you start this tutorial, complete the following items:

- If you are new to smart contract development, learn how to [Deploy Your First Smart Contract](/getting-started/deploy-your-first-contract).
- Set up a cryptocurrency wallet such as [MetaMask](https://metamask.io/).
- Fund your wallet with the following testnet tokens:
  - Get testnet MATIC from [faucet.polygon.technology](https://faucet.polygon.technology) to pay for your on-chain transactions.
  - Get 20 ERC-677 testnet LINK from [faucets.chain.link/mumbai](https://faucets.chain.link/mumbai).

## Setup steps

1. Open the `EthBalanceMonitor.sol` example contract in Remix.

   {/* prettier-ignore */}
   <CodeSample src="samples/Automation/tutorials/EthBalanceMonitor.sol" showButtonOnly />

1.

## Examine the example code

`EthBalanceMonitor` is ownable, pauseable, and compatible with the `AutomationCompatibleInterface` contract:

- **Ownable**: The contract has an owner address, and provides basic authorization control functions. This simplifies the implementation of _user permissions_ and allows for transfer of ownership.
- **Pauseable**: This feature allows the contract to implement a pause and unpause mechanism that the contract owner can trigger.
- **Compatible**: The `AutomationCompatibleInterface` is necessary to create contracts that are compatible with the Chainlink Automation Network. To learn more about the `AutomationCompatibleInterface` and its uses and functions, read the [Making Compatible Contracts](/chainlink-automation/compatible-contracts) guide.

<Aside type="note" title="Note on Owner Settings">
  Aside from certain features listed below, only owners can withdraw funds and pause or unpause the contract. If the
  contract is paused or unpaused, it will affect `checkUpkeep`, `performUpkeep`, and `topUp` functions.
</Aside>

### Contract functions

Functions with an asterisk (`*`) denote features that only the owner can change. Click on each function to learn more about its parameters and design patterns:

{/* prettier-ignore */}
| Function Name                                                    | Description                                                                            |
| ------------------------------------------------------------------ | -------------------------------------------------------------------------------------- |
| [`setWatchList`\*](#setwatchlist-function) | Addresses to watch minimum balance and how much to top it up. |
| [`setKeeperRegistryAddress`\*](#setkeeperregistryaddress-function) | Updates the `KeeperRegistry` address. |
| [`setMinWaitPeriodSeconds`\*](#setminwaitperiodseconds-function) | Updates the global minimum period between top ups. |
| [`topUp`](#topup-function) | Used by `performUpkeep`. This function will only trigger top up if conditions are met. |

Below are the feed functions in `EthBalanceMonitor`:

| Read Function Name         | Description                                                                                                                         |
| -------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| `getUnderfundedAddresses`  | View function used in `checkUpkeep` to find underfunded balances.                                                                   |
| `getKeeperRegistryAddress` | Views the `KeeperRegistry` address.                                                                                                 |
| `getMinWaitPeriodSeconds`  | Views the global minimum period between top ups.                                                                                    |
| `getWatchList`             | Views addresses to watch minimum balance and how much to top it up.                                                                 |
| `getAccountInfo`           | Provides information about the specific target address, including the last time it was topped up. This function is _external only_. |

### `setWatchList` Function

#### Parameters

| Name              | Description                           | Suggested Setting           |
| ----------------- | ------------------------------------- | --------------------------- |
| `addresses`       | The list of addresses to watch        | (not applicable)            |
| `minBalancesWei`  | The minimum balances for each address | 5000000000000000000 (5 ETH) |
| `topUpAmountsWei` | The amount to top up each address     | 5000000000000000000 (5 ETH) |

Only the owner can `setWatchList`. Each of the parameters should be set with distinct requirements for each address.

### `setKeeperRegistryAddress` Function

#### Parameters

| Name                    | Description                                        |
| ----------------------- | -------------------------------------------------- |
| `keeperRegistryAddress` | Address that requires updating in `KeeperRegistry` |

Only the `keeperRegistryAddress` can `performUpkeep`, which is a _global setting_. `KeeperRegistry` addresses can be found on the [Chainlink Automation app](https://automation.chain.link/). However, only the owner can set a new `KeeperRegistry` after deployment.

### `setMinWaitPeriodSeconds` Function

#### Parameters

| Name     | Description                                                    | Suggested Setting |
| -------- | -------------------------------------------------------------- | ----------------- |
| `period` | Minimum wait period (in seconds) for addresses between funding | 3600 (1 hour)     |

`period` denotes the length of time between top ups for a specific address. This is a _global setting_ that prevents draining of funds from the contract if the private key for an address is compromised or if a gas spike occurs. However, only the owner can set a different minimum wait period after deployment.

### `topUp` Function

#### Parameters

| Name           | Description                                                |
| -------------- | ---------------------------------------------------------- |
| `needsFunding` | List of addresses to fund (addresses must be pre-approved) |

Any address can trigger the `topUp` function. This is an intentional design pattern that shows how easy it is to make an existing contract compatible with Chainlink Automation while maintaining an open interface. All validations are performed before the funding is triggered. If the conditions are not met, any attempt to top up will revert.
