---
section: automation
date: Last Modified
title: "VRF Subscription Balance Monitor"
whatsnext: { "FAQs": "/chainlink-automation/faqs" }
---

import { Address, Aside, CodeSample, CopyText } from "@components"

Automatically top-up your VRF subscription balances using Chainlink Automation to ensure there is sufficient funding for requests. [View the code on GitHub](https://github.com/smartcontractkit/chainlink/blob/develop/contracts/src/v0.8/dev/VRFSubscriptionBalanceMonitor.sol).

<Aside type="caution" title="Disclaimer">
  This tutorial represents an example of using a Chainlink product or service and is provided to help you understand how
  to interact with Chainlink's systems and services so that you can integrate them into your own. This template is
  provided "AS IS" and "AS AVAILABLE" without warranties of any kind, has not been audited, and may be missing key
  checks or error handling to make the usage of the product more clear. Do not use the code in this example in a
  production environment without completing your own audits and application of best practices. Neither Chainlink Labs,
  the Chainlink Foundation, nor Chainlink node operators are responsible for unintended outputs that are generated due
  to errors in code.
</Aside>

## Before you begin

Before you start this tutorial, complete the following items:

- You have a cryptocurrency wallet set up (for example, [MetaMask](https://metamask.io/))
- Your wallet is funded with:
  - The gas currency for the chain where your contract is deployed (for example, Sepolia). [Get 0.5 Sepolia ETH](https://sepoliafaucet.com/).
  - ERC-677 LINK. [Get 20 testnet LINK](https://faucets.chain.link/).
- Create a VRF subscription

<Aside type="note" title="New to smart contracts?">
  This tutorial assumes that you know how to create and deploy basic smart contracts. If you are new to smart contract
  development, deploy a VRF-compatible contract by [following these
  instructions](/getting-started/intermediates-tutorial) and then return to this tutorial.
</Aside>

## Setup steps

This tutorial requires you to set up the following components in VRF before you use Automation to monitor VRF subscriptions:

- [Create VRF subscriptions to monitor](#create-vrf-subscriptions-to-monitor), if you don't already have any
- [Deploy the subscription balance monitor contract](#deploy-the-subscription-balance-monitor-contract)

### Create VRF subscriptions to monitor

If you already have existing VRF subscriptions you would like to monitor, skip to the next step.

If you don't already have existing VRF subscriptions you would like to monitor, create two VRF subscriptions for demo purposes. One subscription will be adequately funded, and the other subscription will be underfunded intentionally so that the balance monitor contract can fund it.

1. Open the VRF Subscription Manager, and connect your wallet.

{/* prettier-ignore */}

{" "}
<div class="remix-callout">
  <a href="https://vrf.chain.link">Open the Subscription Manager</a>
</div>

1. Create two subscriptions:

   - Fund one subscription with 12 testnet LINK to serve as the adequately funded VRF subscription
   - Fund the other subscription with 1 testnet LINK to serve as the underfunded VRF subscription

1. Get the VRF coordinator address and `keyHash` value for the gas lane. For Sepolia these values are:

   | Item             | Value                                                                                                     |
   | ---------------- | --------------------------------------------------------------------------------------------------------- |
   | VRF Coordinator  | <Address contractUrl="https://sepolia.etherscan.io/address/0x8103B0A8A00be2DDC778e6e7eaa21791Cd364625" /> |
   | 30 gwei Key Hash | <CopyText text="0x474e34a077df58807dbe9c96d3c009b23b3c6d0cce433e59bbf5b34f823bc56c" code/>                |

   To find these values for all networks supported by VRF subscription, refer to the [Supported Networks](/vrf/v2/subscription/supported-networks) page.

1. Deploy a VRF-compatible contract for your VRF subscription:

   <CodeSample src="/samples/VRF/VRFD20.sol" showButtonOnly />

   <Aside type="note">
     If you're unfamiliar with deploying smart contracts, deploy a VRF-compatible contract by [following these
     instructions](/getting-started/intermediates-tutorial) and then return to this tutorial.
   </Aside>

### Deploy the subscription balance monitor contract

Deploy the subscription balance monitor contract, using the same address that is the admin owner for your VRF subscriptions. The contract will monitor any VRF subscriptions owned by this address, and fund any underfunded subscriptions using funds owned by this address.

1. Open the `VRFSubscriptionBalanceMonitor.sol` contract in Remix.

   <CodeSample src="/samples/Automation/tutorials/VRFSubscriptionBalanceMonitor.sol" showButtonOnly />

1. Compile contract

1. Connect wallet

1. Deploy contract

## Register the subscription balance monitor contract on Automation

### Get required inputs for the balance monitor contract

The constructor for this contract requires the following information for the supported network that you want to deploy on:

- The LINK token address
- The Automation registry address
- The VRF coordinator address

Additionally, you will choose a minimum wait period between funding multiple subscription IDs. For demo purposes, you will monitor two VRF subscriptions, so you can set this value to `30` seconds.

### Register an upkeep

Registering an upkeep on Chainlink Automation creates a smart contract that will run your VRF subscription balance monitor contract.

1. Open the Chainlink Automation App

1. Select _Custom logic_ trigger

1. Input the address of your deployed contract.

1. Get the ABI from Remix.

1. Select the function to automate.

1. Enter the values for the constructor.

1. Fund the upkeep with X LINK.

## Code example

Below is the main contract `VRFSubscriptionBalanceMonitor.sol`:

<CodeSample src="/samples/Automation/tutorials/VRFSubscriptionBalanceMonitor.sol" />
